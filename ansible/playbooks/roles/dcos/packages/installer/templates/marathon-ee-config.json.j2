{  
    "id":"/{{service.name}}",
    "cmd":"cd $MESOS_SANDBOX && LIBPROCESS_PORT=$PORT1 && /marathon/bin/start --default_accepted_resource_roles \"{{service.role.name}}\" --enable_features \"vips,task_killing,external_volumes,secrets,gpu_resources\" --framework_name {{service.name}} --hostname $LIBPROCESS_IP --http_port $PORT0 --https_port $PORT2 --master zk://master.mesos:2181/mesos --max_tasks_per_offer 1 --mesos_leader_ui_url /mesos --mesos_role {{service.role.name}}  --zk zk://master.mesos:2181/universe/{{service.name}} --mesos_user {{service.user}} --mesos_authentication --mesos_authentication_principal {{service.name}}",
    "user":"nobody",
    "cpus":2,
    "mem":4096,
    "disk":0,
    "instances":1,
    "constraints":[  
       [  
          "hostname",
          "UNIQUE"
       ]
    ],
    "container":{  
       "type":"DOCKER",
       "docker":{  
          "image":"{% if service.registry.repo is defined and service.registry.repo != ""%}{{service.registry.repo}}/{% endif %}{{service.registry.image}}",
          "network":"HOST",
          "privileged":false,
          "parameters":[  
  
          ],
          "forcePullImage":false
       },
       "volumes":[  
          {  
             "containerPath":"/opt/mesosphere",
             "hostPath":"/opt/mesosphere",
             "mode":"RO"
          }
       ]
    },
    "env":{  
       "JVM_OPTS":"-Xms256m -Xmx2g",
       "DCOS_STRICT_SECURITY_ENABLED":"true",
       "DCOS_SERVICE_ACCOUNT_CREDENTIAL_TOFILE":{  
          "secret":"service-credential"
       },
       "MESOS_AUTHENTICATEE":"com_mesosphere_dcos_ClassicRPCAuthenticatee",
       "MESOS_MODULES":"file:///opt/mesosphere/etc/mesos-scheduler-modules/dcos_authenticatee_module.json",
       "MESOS_NATIVE_JAVA_LIBRARY":"/opt/mesosphere/lib/libmesos.so",
       "MESOS_VERBOSE":"true",
       "GLOG_v":"2",
       "PLUGIN_ACS_URL":"https://master.mesos",
       "PLUGIN_AUTHN_MODE":"dcos/jwt",
       "PLUGIN_FRAMEWORK_TYPE":"marathon"
    },
    "healthChecks":[  
       {  
          "path":"/",
          "protocol":"HTTP",
          "portIndex":0,
          "gracePeriodSeconds":1800,
          "intervalSeconds":10,
          "timeoutSeconds":5,
          "maxConsecutiveFailures":3,
          "ignoreHttp1xx":false
       }
    ],
    "secrets":{  
       "service-credential":{  
          "source":"{{service.name}}/{{service.secret_name | default('secret')}}"
       }
    },
    "labels":{  
       "DCOS_SERVICE_NAME":"{{service.name}}",
       "DCOS_SERVICE_PORT_INDEX":"0",
       "DCOS_SERVICE_SCHEME":"http"
    },
    "portDefinitions":[  
       {  
          "port":0,
          "name":"http"
       },
       {  
          "port":0,
          "name":"libprocess"
       },
       {  
          "port":0,
          "name":"https"
       }
    ]{% if service.registry.docker_credential is defined and  service.registry.docker_credential != "" %}, 
    "fetch":[  
       {  
          "uri":"{{service.registry.docker_credential}}"
       }
    ]
    {% endif %}
  }