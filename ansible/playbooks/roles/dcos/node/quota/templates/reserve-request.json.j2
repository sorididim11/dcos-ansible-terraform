{% for target in nodes %}
{% if item.1.hostname == target.hostname %} 
{
  "type": "{{op_type | upper}}",
  "{{op_type | lower }}": {
    "agent_id": {
      "value": "{{ target.id }}"
    },
    "resources": [
      {
        "type": "SCALAR",
        "name": "cpus",
        "reservation": {
          "principal": "{{item.1.principal}}"
        },
        "role": "{{item.1.name}}",
        "scalar": {
          "value": {{ item.1.cpus | default(0.0) }}
        }
      },
      {
        "type": "SCALAR",
        "name": "gpus",
        "reservation": {
          "principal": "{{item.1.principal}}"
        },
        "role": "{{item.1.name}}",
        "scalar": {
          "value": {{ item.1.gpus | default(0.0) }}
        }
      },
  {% if role.begin_port is defined %}
      {
        "type": "RANGES",
        "name": "ports",
        "reservation": {
          "principal": "{{item.1.principal}}"
        },
        "role": "{{item.1.name}}",
        "ranges": {
          "range": [
            {
              "begin": {{ item.1.begin_port }},
              "end": {{ item.1.end_port }}
            }
          ]
        }
      },
  {% endif %}
      {
        "type": "SCALAR",
        "name": "mem",
        "reservation": {
          "principal": "{{item.1.principal}}"
        },
        "role": "{{item.1.name}}",
        "scalar": {
          "value": {{ item.1.mem | default(0) }}
        }
      }
    ]
  }
}

 {% endif %}
{% endfor %}
